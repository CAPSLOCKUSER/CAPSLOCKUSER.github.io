{"version":3,"sources":["../../js/lib/virtual-dom.js"],"names":[],"mappings":"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","file":"virtual-dom.js","sourcesContent":["/*\n  Basic Virtual Dom lib written by Miklos Megyes (https://github.com/CAPSLOCKUSER)\n  Licence is WTFPL (http://www.wtfpl.net/)\n*/\n\ndefine(['lib/utils'], ({ objectWithoutUndefined }) => {\n  function vDom(type, props, ...children) {\n    const isChildrenInArray = children.length === 1 && Array.isArray(children[0]);\n\n    return {\n      type,\n      props: props || {},\n      children: isChildrenInArray ? children[0] : children,\n    };\n  }\n\n  function getVNodeType(vNode) {\n    const type = typeof vNode;\n    switch (type) {\n      case 'boolean':\n      case 'string':\n      case 'number':\n      case 'undefined':\n        return type;\n      case 'object':\n        if (vNode === null) {\n          return 'null';\n        }\n        if (typeof vNode.type === 'function') {\n          return 'component';\n        }\n        return 'element';\n      default:\n        return 'unsupported';\n    }\n  }\n\n  const booleanProps = ['selected', 'disabled', 'checked'];\n\n  function manifestElement(vNode) {\n    const { type, props, children } = vNode;\n    const $el = document.createElement(type);\n\n    Object.keys(props).forEach(attr => {\n      if (booleanProps.includes(attr)) {\n        if (props[attr]) {\n          $el.setAttribute(attr, attr);\n        }\n        return;\n      }\n      $el.setAttribute(attr, props[attr]);\n    });\n\n    children.forEach(vNodeChild => {\n      const $new = vCreate(vNodeChild);\n      $el.appendChild($new)\n    });\n\n    return $el;\n  }\n\n  function manifestComponent(vNode) {\n    const { props, componentInstance } = vNode;\n    if (componentInstance.isMounted) {\n      componentInstance.update(props, componentInstance.state);\n    } else {\n      componentInstance.mount();\n    }\n    return componentInstance.$dom;\n  }\n\n  function vCreate(vNode) {\n    switch (getVNodeType(vNode)) {\n      case 'boolean':\n        return document.createTextNode(vNode ? 'true' : 'false');\n      case 'string':\n      case 'number':\n        return document.createTextNode(vNode);\n      case 'null':\n        return document.createTextNode('');\n      case 'undefined':\n        console.error('this should not happen');\n        return document.createTextNode('');\n      case 'component':\n        return manifestComponent(vNode);\n      case 'element':\n        return manifestElement(vNode);\n      default:\n        console.error(vNode);\n        throw new Error('Unsupported vNode type');\n    }\n  }\n\n  function isVNodeComponent(vNode) {\n    return getVNodeType(vNode) === 'component';\n  }\n\n  function isVNodeElement(vNode) {\n    return getVNodeType(vNode) === 'element';\n  }\n\n  function vConstructComponents(vNew, vOld) {\n    if (isVNodeComponent(vNew)) {\n      if (isVNodeComponent(vOld) && vNew.type === vOld.type) {\n        vNew.componentInstance = vOld.componentInstance;\n      } else {\n        const Component = vNew.type;\n        vNew.componentInstance = new Component(vNew.props);\n        vNew.componentInstance.vTree = vNew;\n      }\n    }\n    if (isVNodeElement(vNew)) {\n      vNew.children.forEach((vChild, index) => {\n        const vTwin = isVNodeElement(vOld) ? vOld.children[index] : null;\n        vConstructComponents(vChild, vTwin);\n      });\n    }\n  }\n\n  function vRender(vNode, vOld) {\n    vConstructComponents(vNode, vOld);\n    return vCreate(vNode);\n  }\n\n  class Component {\n    constructor(props) {\n      const defaultProps = Object.getPrototypeOf(this).constructor.defaultProps || {};\n      this.props = { ...defaultProps, ...objectWithoutUndefined(props) };\n      this.state = this.state || {};\n      this.$dom = null;\n      this.vTree = null;\n      this.isMounted = false;\n    }\n\n    componentDidMount() {}\n    componentDidUpdate() {}\n    shouldComponentUpdate() { return true; }\n\n    setState(data) {\n      const newState = {\n        ...this.state,\n        ...data,\n      };\n      this.update(this.props, newState);\n    }\n\n    update(newProps, newState) {\n      const shouldUpdate = this.shouldComponentUpdate(newProps, newState);\n      this.props = newProps;\n      this.state = newState;\n      if (!shouldUpdate) return;\n\n      const vNode = this.render();\n      const $actual = vRender(vNode, this.vTree);\n      this.vTree = vNode;\n\n      this.$dom.parentNode.replaceChild($actual, this.$dom);\n      this.$dom = $actual;\n\n      this.componentDidUpdate();\n    }\n\n    mount() {\n      const vNode = this.render();\n      this.$dom = vRender(vNode);\n      this.vTree = vNode;\n      this.isMounted = true;\n\n      this.componentDidMount();\n      this.componentDidUpdate();\n    }\n  }\n\n  function register($node, vNode) {\n    const $app = vRender(vNode);\n    $node.appendChild($app);\n  }\n\n  return {\n    vDom,\n    Component,\n    register,\n  }\n});\n"]}